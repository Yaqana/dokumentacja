\input{head}
\usepackage{graphicx}
\usepackage[breaklinks=true]{hyperref}
\usepackage{dirtree}
\begin{document}

\maketitle

%tu idzie streszczenie na strone poczatkowa
\begin{abstract}
  W~pracy opisano implementację systemu dotyczącego Miejsc Obsługi Podróżnych
  przy autostradach i~drogach ekspresowych w Polsce. Podstawowe składowe tego
  systemu to aplikacje Mopnik i~Mopsim. Są one aplikacjami okienkowymi
  korzystającymi ze wspólnego interfejsu graficznego. Służą do~przeprowadzania
  krótko- i~długoterminowych predykcji ruchu na drogach oraz zajętości miejsc
  parkingowych na~Miejscach Obsługi Podróżnych. Pozostałe dwie części to
  aplikacja mobilna oraz strona internetowa przeznaczone dla kierowców
  poruszających się po drogach. Informują one o~zajętości miejsc parkingowych
  na każdym MOPie w danym momencie oraz predykcji ich zajętości w niedalekiej
  przyszłości.  
  %TODO napisać coś jak będzie co streszczać 
\end{abstract}

\tableofcontents
%\listoffigures
%\listoftables

\chapter*{Słowniczek}\label{r:pojecia}
\addcontentsline{toc}{chapter}{Słowniczek}

\begin{enumerate}
  \item\emph{GDDKiA} -- Generalna Dyrekcja Dróg Krajowych i Autostrad (nasz klient)
  \item\emph{MOP} -- Miejsce Obsługi Podróżnych
  \item\emph{SDR} -- Średniodobowe natężenie ruchu
  \item\emph{GUI} -- Graficzny interfejs użytkownika
  \item\emph{OSM} -- Serwis OpenStreetMap (http://openstreetmap.org)
  \item\emph{RN} -- React Native
  \item\emph{API} -- Interfejs programowania aplikacji (ang. Application programming interface)
\end{enumerate}

\chapter{Wprowadzenie}

\section{Rozwój sieci drogowej w Polsce}
Jeszcze pod koniec XX w. w Polsce znajdowało się zaledwie ok. 500km autostrad i dróg ekspresowych. Pomimo licznych planów rozwojowych, które przyjmowane były w okresie PRL i pierwszych latach III RP, większość dróg budowana była z dużymi opóźnieniami, a niektórych odcinków nie realizowano wcale.\newline
Dopiero przyjęty pod koniec lat 90. program budowy sieci autostrad i dróg ekspresowych w Polsce, mimo wielu modyfikacji jest na bieżąco realizowany. Jako przyczyny\cite{siec-drogowa-IIIrp} przyspieszenia budowy dróg szybkiego ruchu w Polsce wymienia się między innymi: duże zainteresowanie problemem, wzrost liczby pojazdów, dotacje z europejskiego Funduszu Spójności, a także dotacje Unii Europejskiej. Dodatkowym impulsem mobilizującym instytucje rządowe do przyspieszenia prac w tym kierunku stało się przyznanie organizacji Euro 2012 Polsce i Ukrainie.\newline
\begin{figure}[h]
\caption{Rozwój sieci dróg ekspresowych i autostrad w Polsce na początku XX w.}
\includegraphics[width=\textwidth]{images/1024px-PL-Motorways.png}
\end{figure} \newline
Ostatnie lata to okres szczególnie intensywnego rozwoju sieci drogowej w Polsce. Budowa infrastruktury wiąże się również z potrzebą zapewnienia podróżnym bezpieczeństwa i komfortu.
\begin{figure}[h]
\caption{Sieć autostrad i dróg ekspresowych w Polsce (styczeń 2018r.). Na zielono -- odcinki zrealizowane, na czerwono -- odcinki w budowie, na szaro -- odcinki planowane.}
\includegraphics[width=\textwidth]{images/2018.png}
\end{figure}

\section{Miejsca Obsługi Podróżnych}
Miejsce Obsługi Podróżnych (\textbf{MOP}) to teren wydzielony w pasie drogowym (w bliskim sąsiedztwie drogi), wyposażony w parking oraz w infrastrukturę zapewniającą komfort i odpoczynek podróżnym\cite{gddkia-mop}. MOP-y powstają tylko przy autostradach i drogach ekspresowych.\newline
MOP-y w Polsce dzielimy na trzy kategorie:
\begin{enumerate}
    \item \textbf{MOP kategorii I} -- o funkcji wypoczynkowej, wyposażony w stanowiska postojowe (parking), jezdnie manewrowe, urządzenia wypoczynkowe, sanitarne i oświetlenie; dopuszcza się wyposażenie w obiekty małej gastronomii.
    \item \textbf{MOP kategorii II} -- o funkcji wypoczynkowo-usługowej, wyposażony w obiekty, o których mowa
w punkcie 1., oraz w stację paliw, stanowiska obsługi pojazdów, obiekty gastronomiczno-handlowe, punkty informacji turystycznej.
    \item \textbf{MOP kategorii III} -- o funkcji wypoczynkowej i usługowej, wyposażony w obiekty, o których mowa w punkcie 2., obiekty noclegowe oraz inne obiekty handlowo-usługowe w zależności od potrzeb.
\end{enumerate}
\begin{figure}[h]
\caption{Aktualne (styczeń 2018r.) pozycje MOP-ów w Polsce (na niebiesko). MOP-y planowane (na czerwono).}
\includegraphics[width=\textwidth]{images/mopymap.png}
\end{figure}

\section{Problemy związane z budową MOP-ów}
Intensywny rozwój sieci drogowej, a co za tym idzie również szybki wzrost liczby MOP-ów w Polsce stwarza szereg problemów z nimi związanych:
\begin{enumerate}
    \item \textbf{Problemy administracyjno-prawne} -- GDDKIA systematycznie prowadzi kolejne przetargi na dzierżawę MOP zlokalizowanych zarówno przy autostradach jak i drogach ekspresowych. Dzierżawa nieruchomości MOP generuje przychody, które systematycznie zasilają budżet Krajowego Funduszu Drogowego. Nieatrakcyjne warunki umowy lub lokalizacja punktu mogą zniechęcać potencjalnych najemców.
    \item \textbf{Lokalizacja MOP-ów} -- efektywne rozmieszczenie MOP-ów powinno uwzględniać takie parametry jak: odległość od najbliższych MOP-ów, natężenie odcinka drogi, odległość od węzłów komunikacyjnych.
    \item \textbf{Liczba miejsc parkingowych i ich układ} -- MOP-y powinny dysponować taką liczbą miejsc parkingowych, by zapewnić możliwość odpoczynku podróżującym także w warunkach wzmożonego ruchu. Rozmieszczenie miejsc parkingowych powinno zapewnić kierowcom komfort podczas poruszania się pojazdem na terenie punktu.
\end{enumerate}

\section{Symulacja ruchu drogowego w Polsce}
Efektywne rozmieszczenie coraz większej liczby MOP-ów jest jednym z głównych wyzwań, stojących przed planistami dróg. Powinno ono uwzględniać wszystkie kwestie poruszone w poprzednim rozdziale. Jednak rozwój sieci drogowej w Polsce na niespotykaną wcześniej skalę sprawia, że zadanie to jest coraz trudniejsze. Może się okazać, że dane dotyczące natężenia ruchu na danym odcinku drogi, odległości od najbliższych MOP-ów czy węzłów komunikacyjnych są niewystarczające i trudno na ich podstawie określić wykorzystanie MOP-a w okresach wzmożonego ruchu sezonowego lub w przyszłości, wraz z dalszym rozwojem infrastruktury drogowej. Przydatnymi danymi, wykorzystywanymi w modelowaniu ruchu drogowego, są macierze podróży, określające liczbę pojazdów poruszających się pomiędzy danymi parami punktów w zadanym okresie. Planista dróg, wyposażony w macierze podróży, chciałby na ich podstawie wiedzieć:
\begin{enumerate}
	\item Jakie jest natężenie ruchu na poszczególnych odcinkach drogi?
	\item Jak dodanie lub usunięcie (np. w wyniku tymczasowego zatrzymania ruchu) odcinka drogi wpłynie na to natężenie?
	\item Jaka część podróżnych, jadąca danym odcinkiem drogi, chciałaby skorzystać z MOP-a?
\end{enumerate}
Pomocny w przeprowadzeniu tej analizy może okazać się \textbf{Mopsim} -- program komputerowy symulujący ruch pojazdów na
sieci dróg krajowych i autostrad w Polsce.

\section{Przewidywanie liczby potrzebnych miejsc parkingowych}
Mając dane dotyczące natężenia ruchu na danym odcinku drogi (pochodzące z
przeprowadzonych pomiarów lub symulacji) można spróbować określić sumaryczną
liczbę miejsc parkingowych potrzebnych na tym odcinku. W tym celu powszechnie
wykorzystuje się różne metodyki, będące zwykle prostymi wzorami matematycznymi.

Przykład metodyki: 
$$ P_T = N_T \times SDR_T \times WS_T $$
gdzie:
\begin{itemize}
  \item $T$ -- typ pojazdu
  \item $P_T$ -- liczba potrzebnych miejsc parkingowych na 15km drogi
  \item $N_T$ -- wskaźnik przeliczeniowy uwzględniający np. typ MOP-u
  \item $SDR_T$ -- średni dobowy ruch w roku w analizowanym kierunku 
  \item $WS_T$ -- wskaźnik zmienności sezonowej
\end{itemize}
Program \textbf{Mopnik} będzie miał za zadanie umożliwienie korzystania z
takich metodyk -- ich kalibracji (ręcznego wprowadzania niektórych parametrów),
wczytywania potrzebnych danych (np. średniodobowego natężęnia ruchu)
oraz obliczania liczby potrzebnych miejsc parkingowych. \\
Program będzie też umożliwiał integrację z systemem \textbf{Mopsim} dzięki
czemu możliwe będzie zastosowanie wyżej wymienionych metodyk do danych
pochodzących z symulacji, jeśli okaże się, że wyniki rzeczywistych pomiarów są
niepełne. 


\section{Zajętość MOP-ów i dostępne usługi}

Jednym ze wspomnianych wcześniej problemów związanych z budową MOP-ów jest dobór odpowiedniej liczby miejsc parkingowych. Dodatkowo, miejsca te należy odpowiednio podzielić pomiędzy różne typy pojazdów: samochody osobowe, samochody ciężarowe, autobusy, pojazdy przewożące substancje niebezpieczne itd. Podróżni mają też różne potrzeby związane z postojem -- od szybkiego zatankowania samochodu, przez obiad z rodziną na świeżym powietrzu, do spędzenia nocy w kabinie. \newline Aktualnie informację o znajdujących się na MOP-ie usługach można uzyskać ze znaków informacyjnych umieszczonych kilka kilometrów przed zjazdem. Jednak takie oznaczenia nie odpowiadają na kilka ważnych pytań, które możemy mieć na dowolnym etapie podróży:
\begin{enumerate}
	\item Za ile kilometrów znajduje się najbliższa stacja benzynowa? 
	\item Czy starczy mi paliwa do następnej, ponieważ tutaj jest duża kolejka?
	\item Czy na tym MOP-ie jest monitoring?
	\item Czy na tym MOP-ie są wolne miejsca parkingowe? (ten problem jest ważniejszy z punktu widzenia kierowców pojazdów wielkogabarytowych)
	\item Jaka będzie zajętość miejsc parkingowych za godzinę?
\end{enumerate}

Odpowiedzią na te pytania będzie \textbf{Mopsik} (MOP -- System Informowania Kierowców) -- aplikacja mobilna i strona internetowa.

\chapter{Mopnik}\label{r:Mopnik}

\section{Przypadki użycia}
Inżynier GDDKiA może:
\begin{enumerate}
  \item Wprowadzać dane dotyczące \textbf{SDR} oraz położenie MOP-ów z pliku.
  \item Wyświetlić wprowadzone dane na mapie.
  \item Wybrać metodykę, ustawić jej parametry i na jej podstawie wyznaczyć
    liczbę potrzebnych miejsc parkingowych na odcinku drogi oraz na konkretnym
    MOPie.
  \item Wyświetlić wyniki na mapie.
  \item Edytować sieć drogową. 
  \item Wyświetlić wyniki symulacji przeprowadzonych za pomocą systemu
    \textbf{Mopsim} dotyczących:
    \begin{enumerate}
      \item Długo- i krótkoterminowych predykcji \textbf{SDR}.
      \item Krótkoterminowej predykcji zajętości MOPów.
    \end{enumerate}
  \item Zapisać wyniki przeprowadzanych analiz do pliku.
\end{enumerate}

\chapter{Mopsim}\label{r:Mopsim}

\section{Przypadki użycia}
Inżynier GDDKiA może:
\begin{enumerate}
  \item Wprowadzać dane dotyczące sieci drogowej z pliku osm.
  \item Wprowadzać dane dotyczące MOP-ów i macierze podróży z plików csv.
  \item Edytować sieć drogową i dodawać lub usuwać MOP-y.
  \item Przeprowadzać symulację ruchu drogowego.
  \item Wyznaczać przewidywane natężenie ruchu na danym odcinku drogi.
  \item Wyznaczać przewidywaną zajętość MOP-ów i liczbę potrzebnych miejsc parkingowych.
  \item Generować raporty.
  \item Wyświetlić wyniki symulacji za pomocą GUI programu \textbf{Mopnik}.
\end{enumerate}

\section{Architektura}

\subsubsection{Modele mikro-, makroskopowe}
Modelem obliczeniowym w informatyce nazywamy model matematyczny, wykorzystujący zasoby komputerowe do zbadania zachowania złożonego systemu za pomocą symulacji\cite{model}. Modele obliczeniowe są obecnie wykorzystywane w bardzo wielu dziedzinach, m.in. do prognozy pogody, badania zmian klimatycznych, symulacji ruchu planet, a także w biologii czy medycynie. Jednym ze sposobów klasyfikacji modeli jest podział na modele mikro- i makroskopowe\cite{micmac}:
\begin{itemize}
\item w modelu mikroskopowym każda jednostka jest opisywana przez jej charakterystyczne atrybuty i zachowania
\item w modelu makroskopowym analizuje się zagregowane cechy grupy jednostek i ich oddziaływanie na cały system
\end{itemize}
\subsubsection{Model obliczeniowy oparty na agentach}
Jednym z intensywnie stosowanych i rozwijanych modeli obliczeniowych jest model oparty na agentach (ang. \textit{agent-based model}).
Polega on na symulowaniu zachowań i oddziaływania między sobą zbioru autonomicznych agentów, w celu badania ich wpływ na cały system\cite{agent-based}. Zwykle agentom przyporządkowuje się uproszczone zachowania, a następnie umieszcza w pewnym miejscu i czasie. Następnie symuluje się podejmowane przez nich działania i oddziaływania między sobą w celu odtworzenia lub próby wyjaśnienia bardziej złożonych zjawisk. Modele obliczeniowe oparte na agentach stosuje się m.in. w biologii, ekologii czy naukach społecznych.
\subsubsection{System wieloagentowy}
    Nieco innym, choć pokrewnym pojeciem jest system wieloagentowy (ang. \textit{multi-agent system}). Jest to system komputerowy, złożony z wielu oddziałujących między sobą we wspólnym środowisku inteligentnych agentów. W odróżnieniu od modelu opartego na agentach, którego celem jest badanie złożonych procesów na podstawie zachowań poszczególnych jednostek, system wieloagentowy jest koncepcją programistyczną, w której agenci są wykorzystywani do rozwiązywania określonych problemów praktycznych lub inżynieryjnych. Systemy wieloagentowe często stosowane są w sytuacjach, gdy trzeba rozwiązać problemy o charakterze rozproszonym lub złożonych obliczeniowo, np. wyszukiwanie informacji w sieci, zarządzanie sieciami telekomunikacyjnymi, symulacja rynku, wspomaganie zarządzania w przedsiębiorstwie i kontrola ruchu lotniczego\cite{wiki-agent}. Poniższy schemat pokazuje ogólną zasadę działania systemu wieloagentowego. Każdy z agentów działa w środowisku, oddziałując na innych agentów i przeprowadzając obserwacje. Na ich podstawie, agent podejmuje decyzję o ewentualnej modyfikacji planu działania. Następnie agent ponownie wkracza do środowiska.
    \begin{figure}[h]
        \caption{Schemat działania systemu wieloagentowego}
        \includegraphics[width=\textwidth]{images/multi-agent.png}
    \end{figure}
\subsubsection{MATSim -- symulator ruchu drogowego}
MATSim (\textit{Multi-Agent Transport Simulation}) to open-sourcowy, rozszerzalny framework napisany w Javie służący do przeprowadzania symulacji ruchu drogowego. Jego głównymi założeniami jest mikroskopowe modelowanie ruchu oraz oparte na agentach symulowanie dziennych planów poszczególnych jednostek\cite{matsim}. MATSim został zaprojektowany, by modelować aktywności podczas pojedynczego dnia. MATSim oparty jest o zasadę koewolucyjności. Każdy z agentów, reprezentujących pojedynczych uczestników ruchu drogowego, optymalizuje swój codzienny plan, rywalizując z innymi agentami w różnych aspektach korzystania z infrastruktury drogowej.\\
Projekt MATSim został zapoczątkowany w 2004r. na Politechnice Federalnej w Zurychu. Od tego czasu jest intensywnie rozwijany m.in. na tej uczelni, na Uniwersytecie Technicznym w Berlinie, a także przez dziesiątki innych osób reprezentujących różne gałęzie nauki. MATSim został wykorzystany do przeprowadzenia symulacji ruchu drogowego m.in. w Berlinie, Poznaniu, Seulu, Tel Avivie, Singapurze czy też dla całych Niemiec. Podejmowane były też próby wykorzystania go w celu modelowania ruchu lotniczego, symulowania ewakuacji czy badania emisji spalin.
    \begin{figure}[h]
        \caption{Logo MATSim}
        \includegraphics[width=\textwidth]{images/matsim_logo.png}
    \end{figure}
\subsubsection{MATSim -- pętla programu}
Działanie programu polega na przeprowadzeniu określonej liczby iteracji, reprezentowanych przez pętlę na poniższym schemacie. MATSim zaczyna swoje działanie, wczytując ustawienia konfiguracyjne dotyczące sieci drogowej, populacji agentów wraz z ich dziennymi planami oraz metadane o symulacji. Podczas iteracji, każdy z agentów optymalizuje swój początkowy plan. Każdy z nich posiada zdefiniowany zbiór planów, składających się z dziennego łańcucha aktywności i wyniku punktowego, który może być interpretowany jako użyteczność w pojęciu ekonometrycznym. Przed każdą iteracją, agenci wybierają plan ze swojego zbioru. Wybór ten zależy od wyników poszczególnych planów, które są obliczane po każdej pojedynczej symulacji. Pod koniec iteracji, część agentów (najczęściej ok. 10\%) może zmodyfikować wybrany przez siebie plan i dodać go do swojego zbioru planów. 
    \begin{figure}[h]
        \caption{Schemat działania MATSim}
        \includegraphics[width=\textwidth]{images/matsim-workflow.png}
    \end{figure}
\newpage
\subsubsection{Dlaczego MATSim?}
Przeprowadzone próby pokazały, że MATSim może być dobrym narzędziem do symulowania ruchu na drogach w Polsce, w celu zbadania zajętości MOP-ów. Co istotne, wstępne symulacje pokazały, że już jedna iteracja działania głównej pętli programu jest wystarczająca -- wynik jest bardzo zbliżony do optymalnego. Jest to zgodne z intuicją -- w ruchu krajowym należy oczekiwać, że najkrótsza droga spośród dróg danego typu jest najbardziej optymalną, a tworzące się korki nie są tak częste i regularne, jak w intensywnym ruchu miejskim. Czynniki, które nas przekonały do wyboru frameworku MATSim to między innymi:
\begin{itemize}
\item licencja open-source
\item możliwość łatwego rozszerzenia o dodatkowe funkcjonalności, wiele gotowych przykładów
\item obszerna dokumentacja i dostęp do kodu źródłowego
\item możliwość zrównoleglania
\end{itemize}

\subsubsection{Mopsim -- schemat działania programu}
    \begin{figure}[h]
        \caption{Schemat działania programu Mopsim}
        \includegraphics[width=\textwidth]{images/mopsim-workflow.png}
    \end{figure}
Program Mopsim wykorzystuje silnik programu MATSim do przeprowadzania symulacji. Poniższy schemat pokazuje zarys jego działania. Użytkownik programu Mopsim wprowadza dane wejściowe -- plik z danymi o MOP-ach w formacie csv, macierze podróży pomiędzy poszczególnymi miastami powiatowymi dla trzech rodzajów pojazdów -- samochodów osobowych, ciężarowych i autobusów w formacie csv oraz mapę sieci drogowej w formacie osm (\textit{OpenStreetMap}). Dane te są przetwarzane kolejno na odpowiednie pliki konfiguracyjne wykorzystywane przez MATSim -- opis obiektów powiązanych z odcinkami drogi (\textit{facilities}), opis agentów i ich planów oraz opis sieci drogowej. Użytkownik może dodatkowo zmodyfikować sieć dróg lub siatkę MOPów, dodając lub usuwając odpowiednie obiekty. Następnie przeprowadzana jest symulacja, w wyniku której tworzone są wykresy i inne dane analityczne, część których może być przekazana do programu Mopnik w celu wizualizacji.
\newpage
\subsubsection{Mopsim -- technologie}
W programie Mopsim wykorzystano następujące technologie:
\begin{itemize}
\item MATSim -- opisany wyżej
\item Java -- choć MATSim umożliwia też pisanie rozszerzeń w innym języku, zdecydowaliśmy się na wykorzystanie Javy jako języka programowania z uwagi na jej największą integrację z MATSimem. Dodatkowym atutem było nasze doświadczenie z pracy w tym języku, także w aspekcie programowania współbieżnego.
\item OpenStreetMap -- Mopsim korzysta z map OpenStreetMap do opisu sieci drogowej. Jest to projekt społeczności internetowej mający na celu stworzenie darmowej, swobodnie dostępnej mapy całej kuli ziemskiej. Jej atutem są gotowe rozwiązania umożliwiające edycję oraz integracja z MATSimem, który posiada moduł umożliwiający konwersję na format używany do opisu dróg w symulacji.
\end{itemize}


\chapter{Mopsik -- Strona serwerowa - API}\label{r:apka} 

Jednymi z podstawowych danych wczytywanych przez pisane przez nas programy (Mopsik--Mobile oraz Mopsik--Web) są dane o MOPach. Dane te są przedstawiane przez GDDKiA w postaci ogólnie dostępnego skoroszytu programu Excel (rozszerzenie .xlsx) zamieszczanego na stronie internetowej.
Predykcja zajętości MOPów odbywa się na podstawie różnych danych historycznych - ankiet przeprowadzanych na MOPach oraz danych zbieranych za pomocą kamer.
Sensownym wydał się pomysł zbudowania wspólnego interfejsu do przekazywania tych danych naszym aplikacjom. 
\section{Przypadki użycia}
Serwer ze stroną internetową oraz klient aplikacji mobilnej może:
\begin{enumerate}
\item Pobrać informacje na temat pozycji oraz dostępnych usprawnień na MOPach na podstawie najnowszego stanu przedstawionego do tej pory na stronie GDDKiA
\item Pobrać dane o bieżącej zajętości MOPów.
\item Pobrać dane o przewidywanej krótkoterminowo zajętości MOPów generowane na podstawie metodyk predykcji.
\end{enumerate}

\section{Architektura}
Na implementację API serwera składają się dwie części:
\begin{enumerate}
\item Skrypt cron
\item Aplikacja Django
\end{enumerate}
\paragraph{Cron}\mbox{}\\
Na serwerze zostało umieszczone polecenie, które regularnie sprawdza, czy na stronie GDDKiA nie pojawił się nowy arkusz .xlsx z MOPami. Jeśli tak, to jest wywoływana zdefiniowana przez nas w Django komenda $\textit{update\_mops\_db}$, która aktualizuje bazę danych.
\paragraph{Aplikacja Django}\mbox{}\\
Implementacja oparta jest o wersję 2.1 frameworku Django, Python 3.5 oraz bibliotekę django REST framework. Dane są przechowywane w bazie SQLite3. Na ten moment API odpowiada na dwa zapytania:
\begin{itemize}
\item /mops - zwraca wszystkie dane o MOPach agregowane w bazie danych
\item /taken - zwraca dane o zajętości MOPów agregowane w bazie danych
\end{itemize}
Planowane jest rozszerzenie o zapytanie:
\begin{itemize}
\item /forecast - zwraca przewidywane dane o zajętości MOPów w perspektywie krótkoterminowej, np. za 15, 30, 45 oraz 60min
\end{itemize}

\chapter{Mopsik -- Aplikacja mobilna}

\section{Przypadki użycia}
Zarówno w aplikacji mobilnej, jak i na stronie internetowej podróżny może:
\begin{enumerate}
\item Znaleźć MOP-a w wyszukiwarce lub na mapie.
\item Poznać procentową zajętość miejsc parkingowych na MOP-ie dla każdego z trzech typów pojazdów (samochód osobowy, samochód ciężarowy, autobus).
\item Poznać liczbę wolnych miejsc parkingowych oraz ich liczbę ogółem.
\item Poznać predykcję zajętości miejsc parkingowych na najbliższą godzinę.
\item Znaleźć kontakt do operatora MOP-a.
\item Sprawdzić jakie usługi znajdują się na MOP-ie.
\item Wyświetlić wizualizację danych o zajętośći miejsc parkingowych.
\item Edytować preferencje wyświetlania danych dla konretnych typów pojazdów.
\end{enumerate}
Dodatkowo, w aplikacji mobilnej:
\begin{enumerate}
\item Mapa wyświetla aktualną lokalizację użytkownika, co umożliwia wybranie najbliższego MOP-a. 
\item Istnieje możliwość dodanie MOP-a do ulubionych i późniejsze wybranie go z listy zapisanych.
\end{enumerate}


\section{Architektura}

\subsection{Technologia}
\begin{figure}[!htb]
    \centering
    \begin{minipage}{.6\textwidth}
Aplikacja mobilna została napisana w języku \textbf{JavaScript} z użyciem biblioteki \textbf{React~Native} (dalej: RN). Dzięki temu pisząc jeden kod, otrzymujemy aplikację zarówno na telefony z Androidem, jak i iOS.
    \end{minipage}%
    \begin{minipage}{.4\textwidth}
        \centering
        \includegraphics[width=5cm]{images/ReactNative.png}\label{RN_logo}
    \end{minipage}
\end{figure}

Aplikacja w RN zbudowana jest z komponentów, które posiadają stan (obiekt słownikowy) inicjowany w konstruktorze. Funkcja \textit{render()} wywoływana jest przy pierwszym ładowaniu komponentu oraz przy każdej zmianie jego stanu. 

Z komponentów budujemy widoki, czyli wszystko co jest widoczne na ekranie w danym momencie.

Cała aplikacja objęta jest nawigatorem, który odpowiedzialny jest za generowanie menu bocznego oraz przechodzenie między widokami zgodnie z wolą użytkownika. \\

\subsection{Zakładki}
Menu boczne zawiera 5 zakładek: 
\begin{enumerate}
\item \textit{Konfiguracja/Ustawienia} -- umożliwia wybór typów pojazdów, którymi jest zainteresowany użytkownik
\item \textit{Home} -- TODO %TODO
\item \textit{Mapa} -- wyświetla mapę z zaznaczonymi MOP-ami
\item \textit{Ulubione MOP-y} -- wyświetla listę MOP-ów zapisanych do ulubionych
\item \textit{Wyszukiwarka MOP-ów} -- umożliwia wyszukiwanie MOP-a po nazwie, miejscowości, numerze drogi
\end{enumerate}
Istnieje także szósty widok - \textit{Szczegółowe informacje o MOP-ie}, do którego można przejść z \textit{Ulubionych}, \textit{Wyszukiwarki} i \textit{Mapy}. Zawiera on wszystkie informacje o MOP-ie, jego wyposażenie oraz zajętości i liczby miejsc parkingowych dla różnych typów pojazdów.

\subsection{Konfiguracja aplikacji i ustawienia}
Przy pierwszym uruchomieniu aplikacji otwiera się panel konfiguracyjny, w którym należy ustawić dwa parametry:
\begin{enumerate}
\item \textit{Główny typ pojazdu} (pole jednokrotnego wyboru) -- w miejscach, w których znajdują się tylko ogólne informacje o MOP-ie wyświetlamy zajętość tylko dla głównego typu pojazdu
\item \textit{Wszystkie typy pojazdów} (pole wielokrotnego wyboru), którymi zainteresowany jest użytkownik -- w szczegółowych informacjach o MOP-ie wyświetlane są zajętości dla wszystkich zaznaczonych typów
\end{enumerate}
Typy pojazdów
\begin{enumerate}
\item Samochód osobowy
\item Samochód ciężarowy
\item Autobus
\end{enumerate}
Podział został wykonany w oparciu o zróżnicowane potrzeby użytkowników tych pojazdów, a także znaczące różnice w gabarytach, a co za tym idzie -- wymiarach potrzebnych miejsc parkingowych.
Konfigurację aplikacji można zmienić w każdej chwili w zakładce \emph{Ustawienia}.

\subsection{Google Maps}
\subsubsection{Warunki}
Jedną z podstawowych funkcji aplikacji Mopsik jest wyświetlanie mapy Polski z zaznaczonymi MOP-ami. Do tego celu wykorzystaliśmy Google Maps API. Dostęp do samej mapy i oznaczania na niej punktów jest nieodpłatny, dopóki aplikacja jest darmowa i ogólnodostępna\cite{google-api-faq}.
\subsubsection{Działanie}
Połączenie do API uwierzytelniane jest przez klucz wygenerowany na stronie \url{https://console.developers.google.com/apis/credentials}. Z każdym przeładowaniem widoku z mapą do API wysyłane jest zapytanie z prośbą o konkretny fragment mapy świata, który jest zwracany w odpowiedzi, a następnie wyświetlany w aplikacji. Na mapie znajdują się markery oznaczające MOP-y. Kolor markera jest uzależniony od zajętości MOP-a dla wybranego \textit{głównego typu pojazdu}. Aplikacja wyświetla aktualną lokalizację użytkownika oraz umożliwia jej śledzenia (mapa porusza się wraz z użytkownikiem). 
\subsubsection{Wydajność}
Dodawanie markerów na mapie, a szczególnie tych z własną ikoną, znacząco obniża wydajność mapy. Aby ją poprawić zastosowaliśmy kilka zabiegów:
\begin{enumerate}
\item Do mapy dodawane są tylko markery znajdujące się w obecnie widocznym obszarze. Wraz z przesuwaniem mapy ładowane są kolejne.
\item Mapa przeładowywana jest nie częściej niż co 2 sekundy. Zapobiega to ciągłemu odświeżaniu gdy odczyty GPS urządzenia są niedokładne i nieprzerwanie drgają.
%TODO  \item  optymalizacja, której jeszcze nie wymyśliliśmy 
\end{enumerate}
\subsubsection{Bezpieczeństwo}
Śledzenie lokalizacji użytkownika jest realizowane dzięki geolokazji urządzenia przenośnego -- mapy Google nie biorą w niej udziału. Zapytanie wysyłane do Google zawierają jedynie obszar (wpsółrzędne środa oraz przybliżenie), dla którego chcemy wyświetlić mapę. Jeżeli użytkownik aktywuje podążanie mapy za jego aktualnym położeniem, siłą rzeczy zapytania API będą wysyłać jego kolejne lokalizacje. Jednak zakładając korzystanie z map online -- nie ma innej możliwości. 

\subsection{Zapytanie do API}
Po otwarciu aplikacji wykonywane jest zapytanie do API \textit{/mops}, które zwraca wszystkie informacje o MOP-ach. Dane te są przetwarzane i zapamiętywane.
Po wciśnięciu przycisku \textit{odśwież} oraz po otwarciu każdej z zakładek, wykonywane jest zapytanie \textit{/taken} zwracające tylko aktualną liczbę zajętych miejsc parkingowych dla każdego z MOP-ów. Aplikacja aktualizuje te dane w zapisanych MOP-ach oraz przelicza nowe zajętości dla wszystkich typów pojazdów.
Do każdego typu pojazdu, w każdym MOP-ie, przyporządkowywany jest kolor zgodnie z ustaloną legendą (np. dla małej zajętości, do 30\% - zielony, a dla największej - czerwony). Ten kolor jest następnie wykorzystywany przy wizualizacji danych.

\subsection{Użyte biblioteki}
W aplikacji skorzystaliśmy z gotowych bibliotek RN, co znacząco przyspieszyło i ułatwiło pracę.
\begin{enumerate}
\item \textbf{lodash} \\
\url{https://www.npmjs.com/package/lodash}\\
Dostarcza funkcji użytkowych w paradygmacie funkcyjnym. Przydatna w mapowaniu MOP-ów.

\item \textbf{react-native-elements}\\
\url{https://react-native-training.github.io/react-native-elements/}\\ 
Biblioteka zawierająca wiele gotowych komponentów. Skorzystaliśmy m.in. z \textit{Drawer} (menu boczne), \textit{Header} (nagłówek) i \textit{SearchBar} (wyszukiwarka).

\item \textbf{react-native-maps} \\
\url{https://github.com/react-community/react-native-maps}\\
Biblioteka umożliwiająca połączenie do Google Maps API i renderowanie map.

\item \textbf{react-native-svg} \\
\url{https://github.com/react-native-community/react-native-svg}\\
Służy do grafiki wektorowej.

\item \textbf{react-native-svg-circular-progress} \\
\url{https://github.com/stssoftware/react-native-svg-circular-progress}\\
Wykorzystana do rysowania wykresów zajętości MOP-ów. Wymaga bibkioteki \textit{react-native-svg}.

\item \textbf{react-native-swipeout} \\
\url{https://github.com/dancormier/react-native-swipeout}\\
Umożliwia dodawanie przycisków pojawiających się po przesunięciu w bok komponentu. W naszej aplikacji odpowiada za pojawianie się przycisku \textit{Usuń} na liście ulubionych MOP-ów.

\item \textbf{react-native-table-component} \\
\url{https://github.com/Gil2015/react-native-table-component}\\
Generuje tabelę z liczbą wolnych miejsc parkingowych w zakładce \textit{Szczegółowe informacje o MOP-ie}.

\item \textbf{react-native-vector-icons} \\
\url{https://github.com/oblador/react-native-vector-icons}\\
Dostęp do ikon z \url{https://material.io/icons/}.

\item \textbf{react-navigation} \\
\url{https://reactnavigation.org}\\
Otoczka całej aplikacji. Odpowiada za nawigowanie wewnątrz aplikacji i poruszanie pomiędzy widokami.
\end{enumerate}
%TODO - dodawać nowe

\subsection{Nawigacja}
\begin{figure}[h]
\caption{Schemat nawigacji aplikacji mobilnej Mopsik}
\includegraphics[width=\textwidth]{images/mopsik_mobile_navigation.png}\label{mopsik_nav}
\end{figure}
W aplikacji wykorzystaliśmy dwa typy nawigacji - stos (\textit{StackNavigator}) i menu boczne (\textit{DrawerNavigator}). Architektura nawigacji została przedstawiona na rysunku \ref{mopsik_nav}.\\

Najbardziej zewnętrznym elementem aplikacji jest komponent \textit{DrawerNavigator}. Dodane są do niego widoki \textit{HomeView} oraz \textit{SettingsView}, a także stosy \textit{MapStack}, \textit{FavouritesStack} i \textit{SearchStack}. Menu boczne jest utworzone przez dostosowany do naszych potrzeb komponent \textit{DrawerContent} -- dodane zostało logo i autorzy. \\

Z zakładek \textit{Ulubione}, \textit{Wyszukiwarka} i \textit{Mapa} można przejść do widoku \textit{MopDetailsView}. Za tą część nawigacji odpowiedzialny jest \textit{StackNavigator}. Bedąc w szczegółowych informacjach o MOP-ie w nagłówku pojawia się przycisk cofania. \\

Komponenty Stack obudowują nawigację stosową. Wewnątrz każdego ze stosów można poruszać się po dwóch widokach - głównym i szczegółowym. W widokach głównych (tj. mapie, wyszukiwarce i ulubionych) widoczne są listy wielu MOP-ów. Po kliknięciu w wybrany MOP, aplikacja przenosi do widoku ze szczegółami wraz z odpowiednim parametrem. Na jego podstawie renderowane są informacje o tym wybranych MOP-ie. 

\subsection{Pozostałe komponenty}
Na rysunku \ref{mopsik_mobile_structure} przedstawiona została struktura plików Mopsika. Poza komponentami opisanymi w poprzednim punkcie, aplikacja korzysta z narzędzi znajdujących się folderze \textit{tools}.
\begin{enumerate}
\item \textit{DrawerContent} -- menu boczne
\item \textit{Header} -- nagłówek
\item \textit{UsageCircle} -- wykres kołowy zajętości miejsc parkingowych
\item \textit{UsageTable} -- tabela z liczbą i zajętością miejsc parkingowych dla typów pojazdów wybranych w ustawieniach
\end{enumerate}
\begin{figure}[h]
\caption{Struktura plików aplikacji mobilnej Mopsik}
\dirtree{%
.1 mopsik mobile.
.2 src.
.3 components.
.4 stacks.
.5 FavouritesStack.js.
.5 MapStack.js.
.5 SearchStack.js.
.4 tools.
.5 DrawerContent.js.
.5 Header.js.
.5 UsageCircle.js.
.5 UsageTable.js.
.4 views.
.5 FavouritesView.js.
.5 HomeView.js.
.5 MapView.js.
.5 MopDetailsView.js.
.5 SearchView.js.
.5 SettingsView.js.
.3 config.
.4 facilities.js.
.4 favourites.js.
.4 mops.js.
.4 settings.js.
.4 styles.js.
.4 themes.js.
.4 vehicles.js.
.3 images.
.4 ....
.2 ....
}\label{mopsik_mobile_structure}
\end{figure}

\subsection{Pliki konfiguracyjne i funkcje}
W folderze \textit{config} znajdują się pliki, w których zdefiniowane są dane statyczne oraz funkcje odpowiedzielne za przetwarzanie danych.
\begin{enumerate}
\item \textit{facilities} -- zdefiniowane usługi dostępne na MOP-ach, odpowiadające im polskie nazwy oraz ikony, funkcje generujące komplet ikon do wyświetlania w informacjach o MOP-ie
\item \textit{favourites} -- funckje odpowiedzialne za pobieranie MOP-ów zapisanych do ulubionych, zapisywanie, usuwanie
\item \textit{mops} -- funkcje pobierające informacje o MOP-ach z API, dobierające kolory według legendy
\item \textit{settings} -- plik ze zmiennymi przechowującymi ustawienia aplikacji
\item \textit{styles} -- zdefiniowane style komponentów
\item \textit{themes} -- zdefiniowane motywy kolorystyczne
\item \textit{vehicles} -- typy pojazdów wraz z polskimi nazwami i ikonami
\end{enumerate}

\subsection{Zapisywanie danych}
Podczas działania aplikacji dane zapisywane są w zmiennych znajdujących się m.in. w plikach mops.js i settings.js. Można nazwać je pseudoglobalnymi, ponieważ ich wartość można zmieniać w każdym kompomencie, o ile zostały odpowiednio zaimportowane. Informacje te są tracone wraz z zamknięciem aplikacji.\\
Dane dotyczące ustawień użytkownika oraz ulubionych MOP-ów nie znikają. Do tego celu wykorzystujemy AsyncStorage. Dane pobierane i zapisywane są asynchronicznie. Zasób ma postać słownika -- każda wartość znajduje się pod nadanym jej kluczem.


\chapter{Dokumentacja użytkowa i~opis implementacji}\label{r:impl}

Program przygotowany dla systemu operacyjnego M\$ Windows uruchamia
się energicznym dwumlaskiem na jego ikonce w~folderze
\verb+\\FIDO\FOO\BLABA+.  Następnie kolistym ruchem ręki należy
naprowadzić kursor na menu \texttt{Blabaliza} i~uaktywnić pozycję
\texttt{Otwórz plik}.  Po wybraniu pliku i~zatwierdzeniu wyboru
przyciskiem \texttt{OK} rozpocznie się proces blabalizy.  Wyniki
zostaną zapisane w~pliku o~nazwie \texttt{99-1a.tx.43} w~bieżącym
folderze.


\chapter{Podsumowanie}

W~pracy przedstawiono pierwszą efektywną implementację blabalizatora
różnicowego.  Umiejętność wykonania blabalizy numerycznej dla danych
,,z życia'' stanowi dla blabalii fetorycznej podobny przełom, jak dla
innych dziedzin wiedzy stanowiło ogłoszenie teorii Mikołaja Kopernika
i~Gryzybór Głombaskiego.  Z~pewnością w~rozpocznynającym się XXI wieku
będziemy obserwować rozkwit blabalii fetorycznej.

Trudno przewidzieć wszystkie nowe możliwości, ale te co bardziej
oczywiste można wskazać już teraz.  Są to:
\begin{itemize}
\item degryzmolizacja wieńców telecentrycznych,
\item realizacja zimnej reakcji lambliarnej,
\item loty celulityczne,
\item dokładne obliczenie wieku Wszechświata.
\end{itemize}

\section{Perspektywy wykorzystania w~przemyśle}

Ze względu na znaczenie strategiczne wyników pracy ten punkt uległ
utajnieniu.

\appendix

\chapter{Główna pętla programu zapisana w~języku T\=oFoo}

\begin{verbatim}
[[foo]{,}[[a3,(([(,),{[[]]}]),
  [1; [{,13},[[[11],11],231]]].
  [13;[!xz]].
  [42;[{,x},[[2],{'a'},14]]].
  [br;[XQ*10]].
 ), 2q, for, [1,]2, [..].[7]{x}],[(((,[[1{{123,},},;.112]],
        else 42;
   . 'b'.. '9', [[13141],{13414}], 11),
 [1; [[134,sigma],22]].
 [2; [[rho,-],11]].
 )[14].
 ), {1234}],]. [map [cc], 1, 22]. [rho x 1]. {22; [22]},
       dd.
 [11; sigma].
        ss.4.c.q.42.b.ll.ls.chmod.aux.rm.foo;
 [112.34; rho];
        001110101010101010101010101010101111101001@
 [22%f4].
 cq. rep. else 7;
 ]. hlt
\end{verbatim}

\chapter{Przykładowe dane wejściowe algorytmu}

\begin{center}
  \begin{tabular}{rrr}
    $\alpha$ & $\beta$ & $\gamma_7$ \\
    901384 & 13784 & 1341\\
    68746546 & 13498& 09165\\
    918324719& 1789 & 1310 \\
    9089 & 91032874& 1873 \\
    1 & 9187 & 19032874193 \\
    90143 & 01938 & 0193284 \\
    309132 & $-1349$ & $-149089088$ \\
    0202122 & 1234132 & 918324098 \\
    11234 & $-109234$ & 1934 \\
  \end{tabular}
\end{center}

\chapter{Przykładowe wyniki blabalizy
    (ze~współczynnikami~$\sigma$-$\rho$)}

\begin{center}
  \begin{tabular}{lrrrr}
    & Współczynniki \\
    & Głombaskiego & $\rho$ & $\sigma$ & $\sigma$-$\rho$\\
    $\gamma_{0}$ & 1,331 & 2,01 & 13,42 & 0,01 \\
    $\gamma_{1}$ & 1,331 & 113,01 & 13,42 & 0,01 \\
    $\gamma_{2}$ & 1,332 & 0,01 & 13,42 & 0,01 \\
    $\gamma_{3}$ & 1,331 & 51,01 & 13,42 & 0,01 \\
    $\gamma_{4}$ & 1,332 & 3165,01 & 13,42 & 0,01 \\
    $\gamma_{5}$ & 1,331 & 1,01 & 13,42 & 0,01 \\
    $\gamma_{6}$ & 1,330 & 0,01 & 13,42 & 0,01 \\
    $\gamma_{7}$ & 1,331 & 16435,01 & 13,42 & 0,01 \\
    $\gamma_{8}$ & 1,332 & 865336,01 & 13,42 & 0,01 \\
    $\gamma_{9}$ & 1,331 & 34,01 & 13,42 & 0,01 \\
    $\gamma_{10}$ & 1,332 & 7891432,01 & 13,42 & 0,01 \\
    $\gamma_{11}$ & 1,331 & 8913,01 & 13,42 & 0,01 \\
    $\gamma_{12}$ & 1,331 & 13,01 & 13,42 & 0,01 \\
    $\gamma_{13}$ & 1,334 & 789,01 & 13,42 & 0,01 \\
    $\gamma_{14}$ & 1,331 & 4897453,01 & 13,42 & 0,01 \\
    $\gamma_{15}$ & 1,329 & 783591,01 & 13,42 & 0,01 \\
  \end{tabular}
\end{center}

\begin{thebibliography}{99}
\addcontentsline{toc}{chapter}{Bibliografia}

\bibitem[1]{siec-drogowa-IIIrp} Wikipedia, \textit{Program budowy w III RP},\\ \url{https://pl.wikipedia.org/wiki/Autostrady\_i\_drogi\_ekspresowe\_w\_Polsce}

\bibitem[2]{gddkia-mop} GDDKiA, \textit{Generalna Dyrekcja Dróg Krajowych i Autostrad -- Serwis Informacyjny}, \url{https://www.gddkia.gov.pl/pl/963/miejsca-obslugi-podroznych-mop}

\bibitem[3]{model}Melnik, Roderick, Mathematical and Computational Modeling: With Applications in Natural and Social Sciences, Engineering, and the Arts. Wiley. ISBN 978-1-118-85398-6., 2015

\bibitem[4]{micmac}Gustafsson, Leif; Sternad, Mikael. "Bringing consistency to simulation of population models: Poisson Simulation as a bridge between micro and macro simulation". Mathematical Biosciences. 209: 361–385, 2007

\bibitem[5]{agent-based} Niazi, Muaz; Hussain, Amir,
Agent-based Computing from Multi-agent Systems to Agent-Based Models: A Visual Survey", 2011

\bibitem[6]{wiki-agent} Wikipedia, \textit{System wieloagentowy},\\ \url{https://pl.wikipedia.org/wiki/System_wieloagentowy}

\bibitem[7]{matsim} Horni, A, Nagel, K and Axhausen, K W. 2016. Introducing MATSim. In: Horni, A, Nagel, K and
Axhausen, K W. (eds.) The Multi-Agent Transport Simulation MATSim, Pp. 3–8. London: Ubiquity
Press. DOI: http://dx.doi.org/10.5334/baw.1. License: CC-BY 4.0

\bibitem[8]{google-api-faq} Developers Google, \textit{FAQ -- Google Maps API},\\ \url{https://developers.google.com/maps/faq}

\bibitem[Blar16]{eb1} Elizjusz Blarbarucki, \textit{O pewnych
    aspektach pewnych aspektów}, Astrolog Polski, Zeszyt 16, Warszawa
  1916.

\bibitem[Fif01]{ff-sr} Filigran Fifak, \textit{O fetorach
    $\sigma$-$\rho$}, Acta Fetorica, 2001.

\bibitem[Głomb04]{grglo} Gryzybór Głombaski, \textit{Parazytonikacja
    blabiczna fetorów -- nowa teoria wszystkiego}, Warszawa 1904.

\bibitem[Hopp96]{hopp} Claude Hopper, \textit{On some $\Pi$-hedral
    surfaces in quasi-quasi space}, Omnius University Press, 1996.

\bibitem[Leuk00]{leuk} Lechoslav Leukocyt, \textit{Oval mappings ab ovo},
  Materiały Białostockiej Konferencji Hodowców Drobiu, 2000.

\bibitem[Rozk93]{JR} Josip A.~Rozkosza, \textit{O pewnych własnościach
    pewnych funkcji}, Północnopomorski Dziennik Matematyczny 63491
  (1993).

\bibitem[Spy59]{spyrpt} Mrowclaw Spyrpt, \textit{A matrix is a matrix
    is a matrix}, Mat. Zburp., 91 (1959) 28--35.

\bibitem[Sri64]{srinis} Rajagopalachari Sriniswamiramanathan,
  \textit{Some expansions on the Flausgloten Theorem on locally
    congested lutches}, J. Math.  Soc., North Bombay, 13 (1964) 72--6.

\bibitem[Whi25]{russell} Alfred N. Whitehead, Bertrand Russell,
  \textit{Principia Mathematica}, Cambridge University Press, 1925.

\bibitem[Zen69]{heu} Zenon Zenon, \textit{Użyteczne heurystyki
    w~blabalizie}, Młody Technik, nr~11, 1969.

\end{thebibliography}

\end{document}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% coding: latin-2
%%% End:
